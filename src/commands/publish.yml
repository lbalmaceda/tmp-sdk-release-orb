description: >
  This command verifies if the version in the package.json file is
  already published, and if not, it will attempt to publish it to Npm.

parameters:
  publish-command:
    type: string
    default: ""
    description: "The command to use to publish the package, including any additional flags"
  npm-token-key:
    type: env_var_name
    default: NPM_TOKEN
    description: "The name of the environment variable with the Npm Automation Token"
  pkg-manager:
    type: enum
    default: npm
    description: "Default node package manager to use"
    enum:
      - npm
      - yarn

steps:
  - run:
      environment:
        PUBLISH_COMMAND: <<parameters.publish-command>>
        NPM_TOKEN_KEY: <<parameters.npm-token-key>>
        PKG_MANAGER: <<parameters.pkg-manager>>
      name: Check package version and publish to npm if required
      command: <<include(scripts/publish-to-npm.sh)>>
