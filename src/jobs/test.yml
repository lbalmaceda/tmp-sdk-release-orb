description: >
  Installs packages and runs the tests using npm.

executor: default

parameters:
  test-command:
    type: string
    default: ""
    description: "The command to run the tests with"
  pkg-manager:
    type: enum
    default: npm
    description: "Default node package manager to use"
    enum:
      - npm
      - yarn

steps:
  - checkout
  - install-packages:
      pkg-manager: <<parameters.pkg-manager>>
      after-deps:
        - when:
            condition: <<parameters.test-command>>
            steps:
              - run:
                  name: "Running tests"
                  command: <<parameters.test-command>>
        - unless:
            condition: <<parameters.test-command>>
            steps:
              - run:
                  name: "Running tests"
                  command: <<parameters.pkg-manager>> test
